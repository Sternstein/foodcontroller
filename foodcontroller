#!/usr/bin/env ruby
require "rubygems" # ruby1.9 doesn't "require" it though
require "rainbow"
require "thor"
require "terminal-table"
require "pg"
require "date"
require_relative "db.rb"

class MyThorCommand < Thor
  desc "new", "Puts new food in database. Put arguments in the order"
  def new
    db = Db.new
	  db.show_templates	
		ans = ask "Please choose a template : "
    a = ans.to_i
		amount = ask "How much do you have : "
		am = amount.to_i
		puts "Choose date : "
		puts "1. Today"
		puts "2. Yesterday"
		puts "3. My date"
		an = ask 'Enter a number'
		data = an.to_i
		case data
		when 1
			date = Date.today
		when 2
			date = Date.today - 1
		when 3
			year = ask 'Enter your date in format : 2018'
			month = ask 'Enter your date in format : 01 '
			day = ask 'Enter your date in format : 31 '
			y = year.to_i
			m = month.to_i
			d = day.to_i
			date = Date.new(y,m,d)
		end
		db.insert_food(a,am,date)
  end

	desc "template", "Work with food templates"
	method_option :list, :aliases => "-l", :desc => "Show list of templates"  	
	method_option :create, :aliases => "-c", :desc => "Create new template"  	
	def template
	list = options[:list]
	create = options[:create]
	db = Db.new
  if list
    db.show_templates_full
	end
	if create
		name = ask "Put name of food : "
		grmg = Array.new
		grmg = ["gr", "mg", "p"]
		correct_answer = nil
			until correct_answer				
				measure = (ask "Enter measure Gramms/Milligrams/Pieces : ", :limited_to => ["gr", "mg", "p"])
				correct_answer = grmg.include?(measure) ? measure : nil
				say ("Your response must be one of: gr / mg. Please try again.") unless correct_answer
				correct_answer
			end
			
		speed = ask "How fast will you eat it : "
    expire = ask "How long you can keep it : "
		sp = speed.to_i
    ex = expire.to_i
    db.insert_template(name,sp,ex,measure)
	end
	end

  desc "show", "Show all food"
  def show
    db = Db.new
    db.show
  end

  desc "db", "Works with database"
	method_option :create, :aliases => "-c", :desc => "Create db"  
	method_option :drop, :aliases => "-d", :desc => "Drop db"  
	def db
		create = options[:create]
		drop = options[:drop]
		db = Db.new
    if create
      db.db_create
		end
		if drop
      db.db_drop
		end
  end
end


MyThorCommand.start
